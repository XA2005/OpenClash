import{u as T,a as q,b as H,c as M,v as N,o as X,e as h,d,f as G,i as o,g as J,S as K,B as C,I as O,F as Q,t as $,z as b,s as w,h as E,j as W,k as R,l as Y,m as Z,n as tt}from"./index-Jq4vk9jB.js";import{D as et}from"./DocumentTitle-CQWpQ_-K.js";var r=[];for(var y=0;y<256;++y)r.push((y+256).toString(16).slice(1));function nt(t,n=0){return(r[t[n+0]]+r[t[n+1]]+r[t[n+2]]+r[t[n+3]]+"-"+r[t[n+4]]+r[t[n+5]]+"-"+r[t[n+6]]+r[t[n+7]]+"-"+r[t[n+8]]+r[t[n+9]]+"-"+r[t[n+10]]+r[t[n+11]]+r[t[n+12]]+r[t[n+13]]+r[t[n+14]]+r[t[n+15]]).toLowerCase()}var g,st=new Uint8Array(16);function rt(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(st)}var at=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const L={randomUUID:at};function it(t,n,x){if(L.randomUUID&&!n&&!t)return L.randomUUID();t=t||{};var i=t.random||(t.rng||rt)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,nt(i)}var lt=$("<option>"),ot=$('<div class="mx-auto flex max-w-screen-sm flex-col items-center gap-4 py-10"><form class=contents><div class="flex w-full flex-col gap-4"><div class=flex-1><label class=label><span class=label-text></span></label><input name=url type=url class="input input-bordered w-full"placeholder=http(s)://{hostname}:{port} list=defaultEndpoints><datalist id=defaultEndpoints><option value=http://127.0.0.1:9090></option></datalist></div><div class=flex-1><label class=label><span class=label-text></span></label><input name=secret type=password class="input input-bordered w-full"placeholder=secret></div></div></form><div class="grid w-full grid-cols-2 gap-4">'),ct=$('<div class="badge badge-info flex w-full cursor-pointer items-center justify-between gap-4 py-4"><span class=truncate>');const dt=b.object({url:b.string().min(1),secret:b.string()}),ht=()=>{const[t]=T(),n=q(),x=H(),i=s=>{R(s),x("/overview")},_=(s,e)=>Z.get(s,{headers:e?{Authorization:`Bearer ${e}`}:{}}).then(({ok:a})=>a).catch(a=>{const{message:l}=a;E.error(l)}),I=async s=>{const e=h().find(a=>a.id===s);e&&await _(e.url,e.secret)&&i(s)},f=async({url:s,secret:e})=>{const a=tt(s);if(!await _(a,e))return;const l=it(),c=h().slice(),u=c.find(v=>v.url===a);if(!u){w([{id:l,url:a,secret:e},...c]),i(l);return}u.secret=e,u.id=l,w(c),i(l)},D=s=>{const{message:e}=s;E.error(e)},{form:S}=M({extend:N({schema:dt}),onSubmit:f,onError:D}),k=s=>{W()===s&&R(""),w(h().filter(e=>e.id!==s))};return X(()=>{let s=n.search||window.location.search;if(s){const a=n.hash.match(/\?.*$/);Array.isArray(a)&&a[0]&&(s=a[0].replace("?",""))}const e=new URLSearchParams(s);e.has("hostname")?f({url:`${e.get("http")?"http:":e.get("https")?"https:":window.location.protocol}//${e.get("hostname")}${e.get("port")?`:${e.get("port")}`:""}`,secret:e.get("secret")??""}):h().length===0&&f({url:"http://127.0.0.1:9090",secret:""})}),[d(et,{get children(){return t("setup")}}),(()=>{var s=ot(),e=s.firstChild,a=e.firstChild,l=a.firstChild,c=l.firstChild,u=c.firstChild,v=c.nextSibling,U=v.nextSibling;U.firstChild;var j=l.nextSibling,A=j.firstChild,V=A.firstChild,B=e.nextSibling;return G(S,e,()=>S),o(u,()=>t("endpointURL")),o(U,d(K,{get when(){return window.location.origin!=="http://127.0.0.1:9090"},get children(){var p=lt();return J(()=>p.value=window.location.origin),p}}),null),o(V,()=>t("secret")),o(a,d(C,{type:"submit",class:"btn-primary uppercase",get children(){return t("add")}}),null),o(B,d(Q,{get each(){return h()},children:({id:p,url:F})=>(()=>{var m=ct(),z=m.firstChild;return m.$$click=()=>I(p),o(z,F),o(m,d(C,{class:"btn-circle btn-ghost btn-xs text-white",onClick:P=>{P.stopPropagation(),k(p)},get children(){return d(O,{})}}),null),m})()})),s})()]};Y(["click"]);export{ht as default};
